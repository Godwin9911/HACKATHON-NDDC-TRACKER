
<script src="js/general/third_party_cdn.js""></script>
<script src="js/general/routes.js""></script>
<script>

const parsedUrl = new URL(window.location.href);
const getUrlParam = parsedUrl.searchParams

const code = getUrlParam.get('code');
console.log(code);



const handleData = () => {
    

    if(code == '501') {
        Swal.fire({
            title: `<h5>Not Implemented<h5>`,
            html:  `<p style="color:tomato; font-size:17px;">An unexpected error occured please try again or contact service support!</p>`,
            confirmButtonText: 'Close'
        }) 

    }else if (code == '403') {
        console.log('Not permmited')
        Swal.fire({
            title: `<h5>Not Allowed<h5>`,
            html:  `<p style="color:tomato; font-size:17px;">Your email is already registered with password, please use your password to login!</p>`,
            confirmButtonText: 'Close'
        }) 
    }else if (code == '200'){
        console.log('succcess')
          //insert the data into broswer localStorage
          const routes = new Routes();
          const url = `${routes.apiOrigin}${routes.currentUser}`; 
          const token = getUrlParam.get('auth');
          fetch(url,{
            method: "GET",
            mode: "cors",
            headers: {
                "Accept": "aplication/json",
                "Authorization": `Bearer ${token}`
            },
          })
          .then(res => res.json())
          .then(data => {
              console.log(data)
              localStorage.setItem('nddc-tracker-user', JSON.stringify(data));
              location.replace('account/user/dashboard.html');
          })
          .catch(err => {
              console.log(err)
                Swal.fire({
                    title: `<h5>Unexpected Error<h5>`,
                    html:  `<p style="color:tomato; font-size:17px;">An error occured, this could a network disrupt or contact the website owner!</p>`,
                    confirmButtonText: 'Close'
                }) 
                setTimeout(() => {
                    location.replace('login.html');
                }, 3000)
          })
    }
    // location.replace('login.html')
}

handleData();


</script>